var Client=function(e){var t={};function a(n){if(t[n])return t[n].exports;var r=t[n]={i:n,l:!1,exports:{}};return e[n].call(r.exports,r,r.exports,a),r.l=!0,r.exports}return a.m=e,a.c=t,a.d=function(e,t,n){a.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},a.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},a.t=function(e,t){if(1&t&&(e=a(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(a.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var r in e)a.d(n,r,function(t){return e[t]}.bind(null,r));return n},a.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return a.d(t,"a",t),t},a.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},a.p="",a(a.s=1)}([function(e,t,a){},function(e,t,a){"use strict";a.r(t),a.d(t,"validateUserInput",(function(){return n})),a.d(t,"calculateDaysToGo",(function(){return r})),a.d(t,"renderHTMLTemplate",(function(){return i})),a.d(t,"renderSavedTrips",(function(){return o})),a.d(t,"handleSubmit",(function(){return c})),a.d(t,"saveTrip",(function(){return d})),a.d(t,"removeTrip",(function(){return l})),a.d(t,"getWeatherBitData",(function(){return v})),a.d(t,"getGeonameData",(function(){return y})),a.d(t,"getPixabayImages",(function(){return g}));const n=e=>{for(let t of e)return t.value?(t.classList.remove("error"),!0):(t.classList.add("error"),!1)},r=e=>{const t=new Date(e)-new Date;let a=new Date(t)/864e5;return a=Number(Math.round(a)),a},i=(e,t,a,n,r,i=!0)=>`\n        <div class="card__image">\n            <img src="${e}">\n        </div>\n        <div class="card__body">\n            <div class="card__text">\n                ${i?"<h2>"+t+"</h2>":"<h4>"+t+"</h4>"}\n                <p>Your trip is in ${a} days time</p>\n            </div>\n            <div class="card__weather">\n                <div class="card__weather--icon">\n                    <img src="icons/${n[0].weather.icon}.png" alt="">\n                </div>\n                <div class="card__weather--info">\n                    <p class="temp">\n                        ${n[0].temp}<sup>&#8451;</sup>\n                    </p>\n                    <p>${n[0].weather.description}</p>\n                </div>\n            </div>\n        </div>\n        <div class="card__footer">\n            <button \n                class="btn btn__save" \n                type="button" \n                data-trip-id="${r}" \n                onclick="return ${i?"Client.saveTrip()":"Client.removeTrip()"}">\n                    ${i?'<i class="far fa-heart"></i>':'<i class="far fa-trash-alt"></i>'}\n                    ${i?"Save":"Remove"} Trip\n            </button>\n        </div>\n    `,o=()=>{const e=JSON.parse(localStorage.getItem("savedTrips"));if(null!=e){let t=new DocumentFragment;for(let a of e){const e=document.createElement("div");e.classList.add("card","card--column");const n=Client.calculateDaysToGo(a.departureDate);e.innerHTML=Client.renderHTMLTemplate(a.pixabayData.webformatURL,a.destination,n,a.weatherData,a.id,!1),t.appendChild(e)}savedTripsSection.appendChild(t)}},s=document.getElementById("savedTripsSection");document.addEventListener("DOMContentLoaded",()=>{Client.renderSavedTrips()});const c=async e=>{e.preventDefault();const t=document.getElementById("destination"),a=document.getElementById("departureDate"),n=[t,a];if(!Client.validateUserInput(n))return;const r=document.getElementById("tripInfo");let i,o,s;try{if(i=await Client.getGeonameData(t.value),0===i.geonames.length)return;const e=i.geonames[0].lat,n=i.geonames[0].lng,c=Client.calculateDaysToGo(a.value);o=await Client.getWeatherBitData(c,e,n),s=await Client.getPixabayImages("photo","travel",!0,"popular","horizontal",t.value);const d={id:i.geonames[0].geonameId,departureDate:a.value,destination:t.value,leavingDate:a.value,geonameData:{...i.geonames[0]},weatherData:[...o.data],pixabayData:{...s.hits[0]}};f("/save-search-result",d).then(async e=>{let t="images/placeholder.jpg";e.pixabayData.webformatURL&&(t=e.pixabayData.webformatURL);const a=Client.renderHTMLTemplate(e.pixabayData.webformatURL,e.destination,c,e.weatherData,e.id);r.innerHTML=`\n                    <div class="card">\n                        ${a}\n                    </div>\n                `})}catch(e){console.error(e)}},d=async()=>{let e=await p();const t=await u();m(t.id,e)||f("/save-trip",t).then(async t=>{e=await p(),localStorage.setItem("savedTrips",JSON.stringify(e));const a=Client.calculateDaysToGo(t.departureDate);let n=t.pixabayData.webformatURL;n||(n="images/placeholder.jpg");const r=document.createElement("div");r.classList.add("card","card--column"),r.innerHTML=Client.renderHTMLTemplate(n,t.destination,a,t.weatherData,t.id,!1),s.prepend(r)})},l=async(e="/remove-saved-trip",t={})=>{const a=event.target.closest(".card");t={id:event.target.dataset.tripId};const n=await fetch(e,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)}),r=await n.json();localStorage.setItem("savedTrips",JSON.stringify(r)),a.remove()},u=async()=>{const e=await fetch("/get-search-result");return await e.json()},p=async()=>{const e=await fetch("/get-saved-trips");return await e.json()},f=async(e="",t={})=>(await fetch(e,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)})).json(),m=(e,t)=>{if(0!==t.length){for(let a of t)if(a.geonameData.geonameId===e)return!0;return!1}},y=async e=>{const t={BASE_URL:"http://api.geonames.org/searchJSON?formatted=true&q="+e},a=await fetch("/geo-name-locations",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)});return await a.json()},v=async(e,t,a)=>{let n="hourly";e>7&&(n="daily");const r={BASE_URL:`https://api.weatherbit.io/v2.0/forecast/${n}?lat=${t}&lon=${a}`},i=await fetch("/weather-bit-forecast",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(r)});return await i.json()},g=async(e,t,a,n,r,i)=>{const o={BASE_URL:`https://pixabay.com/api/?q=${i.split(" ").join("+")}&image_type=${e}&category=${t}&safesearch=${a}&order=${n}&orientation=${r}`},s=await fetch("/pixabay-images",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(o)});return await s.json()};a(0)}]);